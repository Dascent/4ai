<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customizable Magical QR Code Generator</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        textarea {
            width: 80%;
            max-width: 400px;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Two columns for color pickers */
            gap: 20px;
            margin-bottom: 20px;
            width: 80%;
            max-width: 400px;
        }
        .color-option, .slider-option {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .color-option label, .slider-option label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            text-align: center;
        }
        .color-option input[type="color"] {
            width: 50px;
            height: 50px;
            border: none;
            padding: 0;
            cursor: pointer;
            border-radius: 5px;
            -webkit-appearance: none; /* For Chrome/Safari */
            -moz-appearance: none; /* For Firefox */
        }
        .color-option input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        .color-option input[type="color"]::-webkit-color-swatch {
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .color-option input[type="color"]::-moz-color-swatch {
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .slider-option input[type="range"] {
            width: 100%;
            -webkit-appearance: none; /* Override default look */
            height: 8px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 4px;
        }
        .slider-option input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
        }
        .slider-option input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;

            background-image: linear-gradient(45deg, #a86bff, #5d00ff);
            filter: drop-shadow(0 0 15px rgba(138, 43, 226, 0.7));
            transition: filter 0.3s ease, transform 0.3s ease;
        }
        canvas:hover {
            filter: drop-shadow(0 0 25px rgba(138, 43, 226, 1));
            transform: translateY(-5px);
        }
        #download {
            display: none;
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        #download:hover {
            background-color: #218838;
        }
        #transparencyValue {
            margin-top: 5px;
            font-size: 0.9em;
            color: #777;
        }
		.credits{display:block;margin:30px auto 1px auto;text-align:center;font-size:14px;}
    </style>
</head>
<body>
    <h1>Customizable Magical QR Code Generator</h1>
    <textarea id="content" rows="4" cols="50" placeholder="Enter text or URL..."></textarea>
    <br>

    <div class="controls-grid">
        <div class="color-option">
            <label for="darkColor">QR Module Color:</label>
            <input type="color" id="darkColor" value="#000000">
        </div>
        <div class="color-option">
            <label for="lightColorBase">QR Background Color:</label>
            <input type="color" id="lightColorBase" value="#FFFFFF">
        </div>
        <div class="slider-option" style="grid-column: 1 / span 2;">
            <label for="transparencySlider">QR Background Opacity:</label>
            <input type="range" id="transparencySlider" min="0" max="100" value="100">
            <span id="transparencyValue">100%</span>
        </div>
    </div>
    
    <button id="generate">Generate QR Code</button>
    <br>
    <canvas id="qr-code" width="300" height="300"></canvas>
    <br>
    <a id="download" download="qrcode.png">Download QR Code</a>



<div class="credits">
<p>Created with by <a href="https://wiki.dascent-sigils.com/index.php/Ai/Gemini">Gemini Ai</a> - Check out the <a href="https://generator.dascent-sigils.com/qr-sigils/">enhanced version</a> / <a href="https://wiki.dascent-sigils.com/index.php/QR_Code_Sigils">Read more on wiki</a></p>
</div>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
        // Helper function to convert a number (0-255) to a two-digit hex string
        function toHex(c) {
            const hex = Math.round(c).toString(16);
            return hex.length === 1 ? '0' + hex : hex;
        }

        // Function to generate the QR code
        function generateQRCode() {
            if (typeof QRCode === 'undefined') {
                console.error("ERROR: qrcode.min.js library not loaded. Please check the script tag or network connection.");
                return;
            }
            console.log("DEBUG: generateQRCode function started.");

            const canvas = document.getElementById('qr-code');
            let content = document.getElementById('content').value;
            
            if (!content) {
                content = "https://yourwebsite.com/magical-sigils";
                console.warn("DEBUG: Textarea content is empty. Using default: " + content);
            }
            console.log("DEBUG: Content to encode:", content);

            const darkColor = document.getElementById('darkColor').value; // e.g., #000000
            const lightColorBase = document.getElementById('lightColorBase').value; // e.g., #FFFFFF
            const transparency = document.getElementById('transparencySlider').value; // 0-100

            console.log("DEBUG: Raw input values - Dark:", darkColor, "Light Base:", lightColorBase, "Transparency:", transparency);
            
            // Convert transparency (0-100) to a hex alpha (00-FF)
            const alphaHex = toHex(Number(transparency) * 2.55); // 100 * 2.55 = 255 (FF)
            console.log("DEBUG: Calculated Hex Alpha (00-FF):", alphaHex);

            // The lightColorBase is already #RRGGBB, we just append the alpha
            let finalLightColor = lightColorBase + alphaHex;
            
            // Ensure darkColor is always opaque (#RRGGBBFF)
            let finalDarkColor = darkColor;
            if (finalDarkColor.length === 7) { // If it's #RRGGBB
                finalDarkColor += 'FF';
            }

            console.log("DEBUG: Final Light Color (HEX with alpha):", finalLightColor);
            console.log("DEBUG: Final Dark Color (HEX with alpha):", finalDarkColor);


            const qrOptions = {
                width: 300,
                height: 300,
                color: {
                    dark: finalDarkColor,
                    light: finalLightColor
                },
                // You can experiment with error correction levels if needed (L, M, Q, H)
                // errorCorrectionLevel: 'M' 
            };
            console.log("DEBUG: QR Code Options object to be passed:", qrOptions);

            QRCode.toCanvas(canvas, content, qrOptions, function (error) {
                if (error) {
                    console.error("QR Code generation FAILED! Error details:", error);
                    // Provide user-friendly alert with specific detail if possible
                    alert("Failed to generate QR Code. Error: " + error.message);
                } else {
                    console.log("DEBUG: QR Code generated SUCCESSFULLY!");
                    const downloadLink = document.getElementById('download');
                    downloadLink.href = canvas.toDataURL('image/png');
                    downloadLink.style.display = 'block';
                }
            });
            console.log("DEBUG: QRCode.toCanvas function called.");
        }

        // Update transparency value display and regenerate QR code on slider change
        const transparencySlider = document.getElementById('transparencySlider');
        const transparencyValueSpan = document.getElementById('transparencyValue');

        transparencySlider.addEventListener('input', function() {
            transparencyValueSpan.textContent = `${this.value}%`;
            generateQRCode(); // Live update
        });

        // Generate QR code on button click
        document.getElementById('generate').addEventListener('click', generateQRCode);

        // Generate QR code on page load with default values
        document.addEventListener('DOMContentLoaded', generateQRCode);
    </script>
</body>
</html>
